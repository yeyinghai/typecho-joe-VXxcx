<!--pages/search/search.wxml-->
<view class="search-container">
  <!-- æœç´¢æ¡† -->
  <view class="search-bar">
    <view class="search-input-wrapper">
      <input
        class="search-input"
        type="text"
        placeholder="æœç´¢æ–‡ç« ..."
        value="{{keyword}}"
        bindinput="handleInput"
        confirm-type="search"
        bindconfirm="handleSearchButton"
      />
      <!-- æ¸…é™¤æŒ‰é’® -->
      <view wx:if="{{keyword}}" class="clear-btn" catchtap="handleClearInput">âœ•</view>
      <!-- æœç´¢æŒ‰é’® -->
      <view class="search-icon-btn" bindtap="handleSearchButton">ğŸ”</view>
    </view>
  </view>

  <!-- æœç´¢å†å² -->
  <view class="search-history" wx:if="{{searchHistory.length && !searched}}">
    <view class="history-header">
      <view class="history-title">æœç´¢å†å²</view>
      <view class="history-clear" bindtap="handleClearHistory">æ¸…ç©º</view>
    </view>
    <view class="history-list">
      <view
        class="history-item"
        wx:for="{{searchHistory}}"
        wx:key="index"
        bindtap="handleHistoryTap"
        data-keyword="{{item}}"
      >
        {{item}}
      </view>
    </view>
  </view>

  <!-- æœ€æ–°æ–‡ç«  -->
  <view class="latest-posts" wx:if="{{latestPosts.length && !searched}}">
    <view class="latest-header">
      <view class="latest-title">ğŸ“° æœ€æ–°æ–‡ç« </view>
    </view>
    <view class="latest-list">
      <view
        class="latest-item"
        wx:for="{{latestPosts}}"
        wx:key="id"
        bindtap="handlePostTap"
        data-id="{{item.id}}"
      >
        <image
          wx:if="{{item.thumbnail}}"
          class="latest-thumbnail"
          src="{{item.thumbnail}}"
          mode="aspectFill"
        ></image>
        <view class="latest-content {{item.thumbnail ? '' : 'full-width'}}">
          <view class="latest-title-text">{{item.title}}</view>
          <view class="latest-meta">
            <text class="meta-item">{{item.created}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æœç´¢ç»“æœ -->
  <view class="search-results" wx:if="{{searched}}">
    <!-- ç»“æœç»Ÿè®¡ -->
    <view class="results-header" wx:if="{{!loading || searchResults.length}}">
      æ‰¾åˆ° <text class="highlight">{{searchResults.length}}</text> ç¯‡ç›¸å…³æ–‡ç« 
    </view>

    <!-- åŠ è½½ä¸­ -->
    <view wx:if="{{loading && !searchResults.length}}" class="loading">æœç´¢ä¸­...</view>

    <!-- ç»“æœåˆ—è¡¨ -->
    <view wx:elif="{{searchResults.length}}" class="results-list">
      <view
        class="result-item"
        wx:for="{{searchResults}}"
        wx:key="id"
        bindtap="handlePostTap"
        data-id="{{item.id}}"
      >
        <view class="result-title">{{item.title}}</view>
        <view class="result-excerpt">{{item.excerpt}}</view>
        <view class="result-meta">
          <text class="meta-item">{{item.created}}</text>
          <text class="meta-item">{{item.category}}</text>
        </view>
      </view>

      <!-- åŠ è½½æ›´å¤š -->
      <view wx:if="{{loading}}" class="loading-more">åŠ è½½ä¸­...</view>
      <view wx:elif="{{!hasMore}}" class="no-more">æ²¡æœ‰æ›´å¤šäº†</view>
    </view>

    <!-- æ— ç»“æœ -->
    <view wx:else class="empty-state">
      <view class="empty-icon">ğŸ”</view>
      <view class="empty-text">æ²¡æœ‰æ‰¾åˆ°ç›¸å…³æ–‡ç« </view>
      <view class="empty-tip">æ¢ä¸ªå…³é”®è¯è¯•è¯•å§</view>
    </view>
  </view>

  <!-- åˆå§‹çŠ¶æ€ -->
  <view class="empty-state" wx:if="{{!searched && !searchHistory.length}}">
    <view class="empty-icon">ğŸ”</view>
    <view class="empty-text">è¾“å…¥å…³é”®è¯æœç´¢æ–‡ç« </view>
  </view>
</view>
