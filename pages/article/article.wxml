<!--pages/article/article.wxml-->
<view class="article-container" data-theme="{{readingSettings.theme}}">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading">åŠ è½½ä¸­...</view>

  <!-- æ–‡ç« å†…å®¹ -->
  <view wx:elif="{{article}}" class="article-content">
    <!-- æ–‡ç« å¤´éƒ¨ -->
    <view class="article-header">
      <!-- æ ‡é¢˜ -->
      <view class="article-title">{{article.title}}</view>

      <!-- å…ƒä¿¡æ¯ -->
      <view class="article-meta">
        <view class="meta-row">
          <text class="meta-item">ğŸ“… {{article.created}}</text>
          <text class="meta-item" wx:if="{{article.views !== undefined}}">ğŸ‘ï¸ {{article.views}}</text>
        </view>
        <view class="meta-row" wx:if="{{article.category}}">
          <text class="meta-item">ğŸ“‚ {{article.category}}</text>
        </view>
      </view>

      <!-- å¿«æ·è®¾ç½®æŒ‰é’® -->
      <view class="quick-settings">
        <view
          class="setting-btn {{fontSize === 16 ? 'active' : ''}}"
          bindtap="handleToggleFontSize"
        >
          æ ‡å‡†
        </view>
        <view
          class="setting-btn {{fontSize === 18 ? 'active' : ''}}"
          bindtap="handleToggleFontSize"
        >
          å¤§
        </view>
        <view
          class="setting-btn {{theme === 'dark' ? 'active' : ''}}"
          bindtap="handleToggleTheme"
          data-theme="dark"
        >
          å¤œé—´
        </view>
        <view
          class="setting-btn {{theme === 'sepia' ? 'active' : ''}}"
          bindtap="handleToggleTheme"
          data-theme="sepia"
        >
          æŠ¤çœ¼
        </view>
        <view
          class="setting-btn {{fontSize === 16 && theme === 'light' ? 'active' : ''}}"
          bindtap="handleResetSettings"
        >
          é»˜è®¤
        </view>
      </view>
    </view>

    <!-- æ–‡ç« æ­£æ–‡ -->
    <view
      class="article-body theme-{{theme}}"
      style="font-size: {{fontSize}}px;"
    >
      <block wx:for="{{contentParts}}" wx:key="index">
        <!-- æ–‡æœ¬å†…å®¹ -->
        <rich-text wx:if="{{item.type === 'html'}}" nodes="{{item.content}}"></rich-text>

        <!-- å›¾ç‰‡ï¼ˆå¯ç‚¹å‡»ï¼‰ -->
        <image
          wx:if="{{item.type === 'image'}}"
          class="article-image"
          src="{{item.src}}"
          mode="widthFix"
          bindtap="handleImageTap"
          data-src="{{item.src}}"
          show-menu-by-longpress="{{true}}"
        ></image>

        <!-- æ ‡ç­¾é¡µç»„ä»¶ -->
        <view wx:if="{{item.type === 'tabs'}}" class="joe_tabs">
          <view class="joe_tabs__head">
            <view
              wx:for="{{item.data}}"
              wx:for-item="tab"
              wx:for-index="tabIndex"
              wx:key="tabIndex"
              class="joe_tabs__head-item {{activeTabIndex[item.id] === tabIndex ? 'active' : ''}}"
              bindtap="handleTabChange"
              data-id="{{item.id}}"
              data-index="{{tabIndex}}"
            >
              {{tab.title}}
            </view>
          </view>
          <view class="joe_tabs__body">
            <view
              wx:for="{{item.data}}"
              wx:for-item="tab"
              wx:for-index="tabIndex"
              wx:key="tabIndex"
              class="joe_tabs__body-item"
              wx:if="{{activeTabIndex[item.id] === tabIndex}}"
            >
              <rich-text nodes="{{tab.content}}"></rich-text>
            </view>
          </view>
        </view>

        <!-- æŠ˜å é¢æ¿ç»„ä»¶ -->
        <view wx:if="{{item.type === 'collapse'}}" class="joe_collapse">
          <view
            wx:for="{{item.data}}"
            wx:for-item="panel"
            wx:for-index="panelIndex"
            wx:key="panelIndex"
            class="joe_collapse__item {{collapseExpanded[item.id][panelIndex] ? 'active' : ''}}"
          >
            <view
              class="joe_collapse__item-head"
              bindtap="handleCollapseToggle"
              data-id="{{item.id}}"
              data-index="{{panelIndex}}"
            >
              <view class="joe_collapse__item-head--label">{{panel.title}}</view>
              <view class="joe_collapse__item-head--icon">â–¼</view>
            </view>
            <view
              class="joe_collapse__item-wrapper"
              style="max-height: {{collapseExpanded[item.id][panelIndex] ? '1000px' : '0'}};"
            >
              <view class="joe_collapse__item-wrapper--content">
                <rich-text nodes="{{panel.content}}"></rich-text>
              </view>
            </view>
          </view>
        </view>

        <!-- äº‘ç›˜ä¸‹è½½ç»„ä»¶ -->
        <view
          wx:if="{{item.type === 'cloud'}}"
          class="joe_cloud"
          bindtap="handleCloudClick"
          data-url="{{item.data.url}}"
          data-password="{{item.data.password}}"
        >
          <view class="joe_cloud__logo {{item.data.cloudType}}">{{item.data.icon}}</view>
          <view class="joe_cloud__describe">
            <view class="joe_cloud__describe-title">{{item.data.name}}</view>
            <view class="joe_cloud__describe-type">
              {{item.data.password ? 'æå–ç : ' + item.data.password : 'ç‚¹å‡»ä¸‹è½½'}}
            </view>
          </view>
          <view class="joe_cloud__btn">â†“</view>
        </view>
      </block>
    </view>

    <!-- æ–‡ç« æ ‡ç­¾ï¼ˆæ”¾åœ¨æ–‡ç« æœ«å°¾ï¼‰ -->
    <view class="article-tags-footer" wx:if="{{article.tags && article.tags.length}}">
      <view class="tags-label">ğŸ·ï¸ æ ‡ç­¾</view>
      <view class="tags-list">
        <view class="tag-item" wx:for="{{article.tags}}" wx:key="slug" bindtap="handleTagTap" data-slug="{{item.slug}}" data-name="{{item.name}}">{{item.name}}</view>
      </view>
    </view>

    <!-- æ–‡ç« åº•éƒ¨æ“ä½œæ  -->
    <view class="article-actions">
      <view class="action-item" bindtap="handleLike">
        <text class="action-icon">{{isLiked ? 'â¤ï¸' : 'ğŸ¤'}}</text>
        <text class="action-count">{{likeCount || 0}}</text>
        <text class="action-text">{{isLiked ? 'å·²ç‚¹èµ' : 'ç‚¹èµ'}}</text>
      </view>
      <view class="action-item" bindtap="handleFavorite">
        <text class="action-icon">{{isFavorited ? 'â­' : 'â˜†'}}</text>
        <text class="action-count">{{favoriteCount || 0}}</text>
        <text class="action-text">{{isFavorited ? 'å·²æ”¶è—' : 'æ”¶è—'}}</text>
      </view>
      <view class="action-item" bindtap="handleShare">
        <text class="action-icon">ğŸ”—</text>
        <text class="action-count">{{shareCount || 0}}</text>
        <text class="action-text">åˆ†äº«</text>
      </view>
    </view>

    <!-- æ–‡ç« åº•éƒ¨ -->
    <view class="article-footer">
      <view class="copyright">
        <view class="copyright-title">ç‰ˆæƒå£°æ˜</view>
        <view class="copyright-text">æœ¬æ–‡ä½œè€…ï¼šå¤œå½±å°çª</view>
        <view class="copyright-text">æœ¬æ–‡é“¾æ¥ï¼š{{articleUrl}}</view>
        <view class="copyright-text">ç‰ˆæƒå£°æ˜ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</view>
<<<<<<< HEAD
        <view class="copyright-text">ä¾µæƒå£°æ˜ï¼šè‹¥ä¾µå®³åˆ°æ‚¨çš„æƒåˆ©ï¼Œè¯·æ‚¨åŠæ—¶è”ç³»æˆ‘ï¼Œåœ¨æ”¶åˆ°é€šçŸ¥åç¬¬ä¸€æ—¶é—´å¤„ç†ï¼Œé‚®ç®±ddh6126459@126.com</view>
=======
>>>>>>> 54264eccc89a7c93cf0975a89bc887d0dd82989a
      </view>
    </view>
  </view>

  <!-- åŠ è½½å¤±è´¥ -->
  <view wx:else class="empty-state">
    <view class="empty-icon">ğŸ˜•</view>
    <view class="empty-text">æ–‡ç« åŠ è½½å¤±è´¥</view>
  </view>
</view>
